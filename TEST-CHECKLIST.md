# ✅ قائمة اختبار شاملة - طاقات السلطان

## قبل الاختبار
1. تشغيل السيرفر: `npm start`
2. فتح المتصفح: `http://localhost:3000`
3. اختبار على **لاب توب** (عرض > 768px) و **جوال** (عرض 522px أو أقل / وضع Responsive)

---

## اختبارات آلية (ملف واحد: tests/test.js)

تشغيل الاختبارات بعد تشغيل السيرفر:

```bash
npm test
```

**ما تغطيه الاختبارات (نزيد عليها لاحقاً):**
- تسجيل دخول أدمن وخطأ كلمة المرور
- إدارة الأسر: عرض، تفاصيل، إضافة نقاط، زيادة مئوية (للأسرة وللطلاب)
- إدارة الطلاب: إضافة نقاط، خصم
- الطلبات: إنشاء، قبول
- **جودة المنطق:** رفض نقاط 0 أو سالبة، رفض نسبة 0، رفض أسرة غير موجودة، رفض خصم أكثر من النقاط المباشرة/الطالب، اتساق إجمالي الأسرة، رفض خصم مئوي يتجاوز المباشر، إضافة ثم خصم نفس المقدار (طالب)، زيادة مئوية على أسرة بلا أفراد
- **Ops:** فحص `/healthz` و`/version` و`/api/public-config`

---

## 1. تسجيل الدخول
| الإجراء | لاب توب | جوال | ملاحظات |
|--------|---------|------|---------|
| دخول بالرمز (4 أرقام) | ☐ | ☐ | |
| دخول أدمن (admin / admin123) | ☐ | ☐ | |
| ظهور رسالة خطأ عند رمز خاطئ | ☐ | ☐ | |

---

## 2. اللوحة الرئيسية (طالب)
| الإجراء | لاب توب | جوال | ملاحظات |
|--------|---------|------|---------|
| ظهور خزانات الوقود | ☐ | ☐ | |
| شريط الطلبات الأسبوعية | ☐ | ☐ | |
| زر الإشعارات | ☐ | ☐ | |
| القائمة السفلية (جوال): الرئيسية، الأسر، الطلاب، الطلبات، خروج | ☐ | ☐ | |
| **إذا أضاف الأدمن نقاط يدوية للطالب** تظهر الخزانات والـ “المجموع” بعد تحديث الصفحة | ☐ | ☐ | تعتمد على إجمالي نقاط الطالب (طلبات مقبولة + تعديلات) |
| **إذا كانت النقاط مخفية** تظهر رسالة "تم إخفاء نقاطك مؤقتاً" بدل الخزانات | ☐ | ☐ | |

---

## 3. إدارة الأسر (أدمن/مشرف)
| الإجراء | لاب توب | جوال | ملاحظات |
|--------|---------|------|---------|
| عرض جدول الأسر (الأفراد، نقاط الأفراد، نقاط الأسرة، الإجمالي) | ☐ | ☐ | على الجوال: سحب أفقياً لرؤية كل الأعمدة |
| **إضافة أسرة** | ☐ | ☐ | |
| **عرض تفاصيل أسرة** (اسم الأسرة أو زر العين) | ☐ | ☐ | |
| **إضافة نقاط للأسرة** (زر +) | ☐ | ☐ | إدخال عدد + سبب اختياري + خيار توزيع على الأفراد |
| **خصم نقاط من الأسرة** (زر -) | ☐ | ☐ | |
| **زيادة مئوية** (%+) | ☐ | ☐ | |
| **خصم مئوي** (%-) | ☐ | ☐ | |
| **تعديل أسرة** (أدمن فقط) | ☐ | ☐ | |
| **حذف أسرة** (أدمن فقط) | ☐ | ☐ | تأكيد ثم تحديث القائمة |
| رجوع من صفحة تفاصيل الأسرة | ☐ | ☐ | |

---

## 4. إدارة الطلاب
| الإجراء | لاب توب | جوال | ملاحظات |
|--------|---------|------|---------|
| عرض جدول الطلاب | ☐ | ☐ | |
| **إضافة طالب** | ☐ | ☐ | اسم + أسرة |
| **إضافة نقاط لطالب** (زر +) | ☐ | ☐ | تحديث النقاط في الصفحة بعد النجاح |
| **خصم نقاط من طالب** (زر -) | ☐ | ☐ | |
| **إخفاء/إظهار النقاط** (زر العين) | ☐ | ☐ | |
| **تعديل طالب** (أدمن) | ☐ | ☐ | |
| **حذف طالب** (أدمن) | ☐ | ☐ | تأكيد ثم تحديث القائمة |

---

## 5. الطلبات
| الإجراء | لاب توب | جوال | ملاحظات |
|--------|---------|------|---------|
| عرض قائمة الطلبات | ☐ | ☐ | |
| **قبول طلب** | ☐ | ☐ | |
| **رفض طلب** (مع سبب) | ☐ | ☐ | |
| طالب: إنشاء طلب جديد | ☐ | ☐ | لجنة + وصف + نقاط |

---

## 6. التقارير والتصدير
| الإجراء | لاب توب | جوال | ملاحظات |
|--------|---------|------|---------|
| صفحة التقارير | ☐ | ☐ | |
| تصدير PDF (طالب / أسرة / الكل) | ☐ | ☐ | |

---

## 7. إضافة/حذف نقاط - ماذا يحدث؟
- **إضافة نقاط لأسرة:** تظهر في "نقاط الأسرة" أو "نقاط الأفراد" حسب خيار التوزيع. الإجمالي يتحدث. خزانات الوقود في تفاصيل الأسرة تتحدث.
- **خصم نقاط من أسرة:** ينقص الإجمالي ونقاط الأسرة/الأفراد حسب الخيار.
- **مهم (إضافة مع تفعيل الطلاب):** عند تفعيل خيار **"إضافة للأفراد أيضاً"** يجب أن يحدث **إضافة لنقاط الأسرة المباشرة + إضافة موزعة للأفراد** (ليس واحداً فقط).
- **مهم (خصم مع تفعيل الطلاب):** عند تفعيل خيار **"تطبيق الخصم على الأفراد أيضاً"** يجب أن يحدث **خصم من نقاط الأسرة المباشرة + خصم من نقاط الأفراد** (ليس واحداً فقط).
- **مهم (خصم مئوي مع تفعيل الطلاب):** عند خصم نسبة مع تفعيل الطلاب يجب أن تُخصم النسبة من **نقاط الأسرة المباشرة** وكذلك من **نقاط كل طالب**.
- **مهم (زيادة مئوية مع تفعيل الطلاب):** عند زيادة نسبة مع تفعيل الطلاب يجب أن تُضاف النسبة إلى **نقاط الأسرة المباشرة** وكذلك تُضاف إلى **نقاط كل طالب**.
- **حذف أسرة:** تختفي من القائمة، الطلاب يصبحون "بدون أسرة".
- **حذف طالب:** يختفي من القائمة ومن طلباته.

---

## 8. التصميم (مثالي)
- [ ] لا قص للنص أو الأزرار على الجوال (استخدم السحب الأفقي للجدول عند الحاجة).
- [ ] المودالات تظهر بالكامل وتُغلق بزر الإلغاء أو X.
- [ ] القائمة السفلية ثابتة على الجوال ولا تغطي المحتوى.
- [ ] الألوان والخطوط واضحة على الجوال واللاب توب.
- [ ] PWA: عند وجود تحديث للتطبيق يظهر تنبيه (يوجد تحديث) مع زر "تحديث الآن".
- [ ] PWA: عند انقطاع الإنترنت تظهر صفحة Offline بدل صفحة بيضاء.
- [ ] PWA: بانر التثبيت لا يظهر بعد إغلاقه في نفس الجلسة (ولا يظهر داخل التطبيق المثبّت).

---

## 9. اختبارات جودة المنطق (آلية)

| الاختبار | الوصف |
|----------|--------|
| مدخلات غير صالحة | رفض نقاط = 0، نسبة = 0، أسرة غير موجودة (404) |
| حدود الخصم | رفض خصم نقاط أكثر من النقاط المباشرة للأسرة، رفض خصم أكثر من نقاط الطالب |
| اتساق الإجمالي | إجمالي الأسرة = نقاط الأفراد + نقاط الأسرة المباشرة |
| خصم مئوي من المباشر فقط | رفض خصم نسبة عندما الناتج يتجاوز النقاط المباشرة (بدون تطبيق على الأفراد) |
| دورة إضافة/خصم طالب | إضافة ثم خصم نفس المقدار يعيد نقاط الطالب للأصل |
| أسرة بلا أفراد + نسبة | زيادة مئوية مع "تطبيق على الأفراد" على أسرة بلا أفراد تزيد المباشر فقط |
| نقاط سالبة | رفض نقاط سالبة في إضافة/خصم |
